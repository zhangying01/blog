+++

date = "2020-11-17"

title = "《深入理解Java虚拟机第三版》——创建对象过程"

description = "深入理解Java虚拟机第三版"

series = ["book", "jvm"]

+++

## Java虚拟机创建对象的过程



1. jvm遇到第一个new关键字

2. 检查指令的参数是否能在常量池中定位到一个类的符号引用

3. 检查这个符号引用代表的类是否已被加载、解析和初始化过。如果没有，执行相应的类加载过程。

4. 类加载检查通过后，为新生对象分配内存

   > 为对象分配空间的任务实际上等同于把一块确定大小的内存从Java堆中划分出来。

5. 内存分配完成之后，虚拟机将分配到的内存空间都初始化为零值

6. jvm对对象进行必要的设置，如：对象是哪个类的实例、如何找到类的元数据信息、对象的哈希码、对象的GC分代年龄信息。（这些信息都存在对象头之中，Object Header)

7. **从虚拟机的视角来看，一个新的对象已经产生**。但从java程序的视角来看，对象创建才刚刚开始。

8. 一般来说（由字节码流中new指令后面是否跟随invokespecial指令所决定，java编译器会在遇到new关键字的地方同时生成这俩条字节码指令，但如果直接通过其他方式产生的则不一定如此），new指令之后会接着执行**init()**方法，按照程序员的意愿对对象进行初始化，这样一个真正可用的对象才算完全被构造出来。

